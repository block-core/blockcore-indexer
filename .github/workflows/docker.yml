name: Docker

# on:
#    push:
#      branches:    
#       - master

on:
  release:
    types:
      - published
      - prereleased

jobs:
  build:
    name: Build and Push
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@master

      - name: deploy
        run: |
          echo "action - ${{ github.event.action }}"
          echo "assets_url - ${{ github.event.assets_url }}"
          echo "action - ${{ github.event.release.action }}"
          echo "release - ${{ github.event.release.release }}"
          echo "release - ${{ github.event.release.release }}"
          echo "environment - ${{ github.event.deployment.task }}"
          echo "payload - ${{ github.event.deployment.payload }}"

      - name: Build the Docker container image
        run: docker build -f "./src/Blockcore.Indexer/Dockerfile" -t docker.pkg.github.com/block-core/blockcore-indexer/blockcoreindexer:latest --label "unstable=true" "."

      - name: Login and Push to GitHub Docker Registry
        run: |
          docker login docker.pkg.github.com -u "blockcore-indexer" -p "${{secrets.GITHUB_TOKEN}}"
          docker push docker.pkg.github.com/block-core/blockcore-indexer/blockcoreindexer:latest
